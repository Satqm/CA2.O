function validateLicense(licenseKey) {
    try {
        // 1. Decrypt the raw bytes
        const bytes = CryptoJS.AES.decrypt(licenseKey, MASTER_KEY);
        
        // 2. Convert bytes to Utf8 string
        const decryptedData = bytes.toString(CryptoJS.enc.Utf8);
        
        // 3. Check if decryption actually returned a string
        if (!decryptedData) {
            return { valid: false, error: 'Invalid key or wrong Master Key' };
        }
        
        // 4. Parse JSON
        const licenseData = JSON.parse(decryptedData);
        
        // 5. Expiry Check
        const expiryDate = new Date(licenseData.expiry);
        const currentDate = new Date();
        if (expiryDate < currentDate) {
            return { valid: false, error: 'License has expired' };
        }
        
        // 6. Device ID Check (Important: The generator must provide this)
        if (licenseData.deviceId && licenseData.deviceId !== getDeviceId()) {
            return { valid: false, error: 'License bound to another device' };
        }
        
        return { valid: true, data: licenseData };
    } catch (error) {
        console.error("Decryption error:", error);
        return { valid: false, error: 'Invalid license format' };
    }
}

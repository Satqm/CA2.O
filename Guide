I'll help you fix these issues step by step. Let's address each problem:

ðŸ“¦ CHANGES NEEDED

PART 1: Fix License Page Layout & Flow

Step 1: Remove "Start Tracking" button and combine with activation

Find this HTML code (around line 500-510):

```html
<button class="start-btn" id="start-btn" style="display: none;">
    <i class="fas fa-play-circle"></i> Start Tracking
</button>

<div class="copyright">
    Â© 2026 CA Final Pro Tracker. Professional Version â€¢ Licensed to Satyam Kumar
</div>
```

REPLACE WITH:

```html
<div class="copyright">
    Â© 2026 CA Final Pro Tracker. Professional Version â€¢ Enter your name and license to begin
</div>
```

Step 2: Update license input layout for better desktop alignment

Find this CSS (around line 80-110):

```css
.license-input-group {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}
```

REPLACE WITH:

```css
.license-input-group {
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
    margin-bottom: 25px;
}

@media (min-width: 768px) {
    .license-input-group {
        grid-template-columns: 1fr 1fr auto;
    }
}

@media (max-width: 480px) {
    .license-input-group {
        grid-template-columns: 1fr;
    }
}
```

Step 3: Update the license input HTML for better structure

Find this HTML (around line 300-320):

```html
<div class="license-input-group">
    <input type="text" 
           id="user-name-input" 
           class="license-input" 
           placeholder="Enter your name"
           maxlength="50">
    <input type="text" 
           id="license-input" 
           class="license-input" 
           placeholder="Enter your license key"
           maxlength="64">
    <button class="license-activate-btn" id="license-activate-btn">
        <i class="fas fa-check"></i> Activate
    </button>
</div>
```

REPLACE WITH:

```html
<div class="license-input-group">
    <div class="input-with-label">
        <label for="user-name-input">Your Name</label>
        <input type="text" 
               id="user-name-input" 
               class="license-input" 
               placeholder="Enter your full name"
               maxlength="50">
    </div>
    <div class="input-with-label">
        <label for="license-input">License Key</label>
        <input type="text" 
               id="license-input" 
               class="license-input" 
               placeholder="XXXX-XXXX-XXXX-XXXX"
               maxlength="64">
    </div>
    <div class="activate-button-container">
        <button class="license-activate-btn" id="license-activate-btn">
            <i class="fas fa-rocket"></i> Activate & Start
        </button>
    </div>
</div>
```

Step 4: Add CSS for the new layout

Add this CSS after the .license-input-group styles:

```css
.input-with-label {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.input-with-label label {
    font-weight: 600;
    color: var(--primary);
    font-size: 14px;
    margin-left: 5px;
}

.activate-button-container {
    display: flex;
    align-items: flex-end;
}

.license-activate-btn {
    padding: 16px 30px;
    background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    white-space: nowrap;
    width: 100%;
    height: 52px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.license-activate-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(46, 204, 113, 0.3);
}

.license-activate-btn i {
    font-size: 18px;
}

.license-activate-btn:disabled {
    background: var(--gray);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}
```

Step 5: Update the trial info section to be more compact

Find this CSS (around line 130-150):

```css
.trial-info {
    text-align: center;
    padding: 15px;
    margin: 20px 0;
    background: rgba(52, 152, 219, 0.1);
    border-radius: 12px;
    border: 2px solid rgba(52, 152, 219, 0.2);
}
```

REPLACE WITH:

```css
.trial-info {
    text-align: center;
    padding: 12px;
    margin: 15px 0;
    background: rgba(52, 152, 219, 0.1);
    border-radius: 12px;
    border: 2px solid rgba(52, 152, 219, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
}

.trial-info h4 {
    color: var(--secondary);
    margin-bottom: 0;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 16px;
}

.trial-info p {
    margin: 5px 0;
    font-size: 14px;
}
```

PART 2: Fix Subject Hours Logic to Respect Manual Inputs

Step 6: Completely rewrite the toggleTopicStatus function

Find the existing toggleTopicStatus function and REPLACE IT ENTIRELY with this:

```javascript
function toggleTopicStatus(subjectId, topicName) {
    if (!userProgress.subjects[subjectId] || !userProgress.subjects[subjectId].topics[topicName]) {
        return;
    }
    
    const topic = userProgress.subjects[subjectId].topics[topicName];
    const currentStatus = topic.status;
    
    // Cycle through statuses: not-started â†’ inprogress â†’ completed â†’ not-started
    const nextStatus = currentStatus === 'not-started' ? 'inprogress' : 
                     currentStatus === 'inprogress' ? 'completed' : 'not-started';
    
    // Store previous status for reference
    const wasCompleted = topic.status === 'completed';
    
    // Update topic status
    topic.status = nextStatus;
    
    // Find syllabus topic data
    const subjectData = syllabusData[subjectId];
    const syllabusTopic = subjectData.topics.find(t => t.name === topicName);
    
    if (nextStatus === 'completed') {
        // Marking as COMPLETED
        console.log(`Marking topic ${topicName} as completed`);
        
        // For each subtopic in this topic
        Object.keys(topic.subtopics).forEach(subtopicName => {
            const subtopic = topic.subtopics[subtopicName];
            
            // IMPORTANT: Check if user has manually entered hours
            const hasManualHours = subtopic.actualHours > 0;
            const isManualEntry = subtopic.manualEntry === true;
            
            console.log(`Subtopic ${subtopicName}: hasManualHours=${hasManualHours}, isManualEntry=${isManualEntry}, actualHours=${subtopic.actualHours}`);
            
            if (hasManualHours || isManualEntry) {
                // User has manually entered hours - RESPECT THEIR INPUT
                // Mark as completed but keep their exact hours
                subtopic.completed = true;
                console.log(`âœ“ Keeping manual hours: ${subtopic.actualHours} hours`);
            } else {
                // No manual hours entered - calculate based on weightage
                if (syllabusTopic) {
                    const subjectPlannedHours = userStudyPlan?.subjectHours?.[subjectId] || 0;
                    const topicWeightage = syllabusTopic.weightage;
                    const topicPlannedHours = (topicWeightage / 100) * subjectPlannedHours;
                    
                    // Find subtopic weight
                    const subtopicData = syllabusTopic.subtopics.find(s => s.name === subtopicName);
                    if (subtopicData) {
                        const subtopicWeightage = subtopicData.weight;
                        // Calculate hours: subtopic weight * topic planned hours
                        subtopic.actualHours = (subtopicWeightage / 100) * topicPlannedHours;
                        console.log(`âœ“ Auto-calculated hours: ${subtopic.actualHours.toFixed(1)} (weight: ${subtopicWeightage}%)`);
                    } else {
                        // Fallback: distribute equally
                        const numSubtopics = Object.keys(topic.subtopics).length;
                        subtopic.actualHours = topicPlannedHours / numSubtopics;
                        console.log(`âœ“ Equally distributed hours: ${subtopic.actualHours.toFixed(1)}`);
                    }
                }
                subtopic.completed = true;
                subtopic.manualEntry = false; // Mark as auto-calculated
            }
        });
        
        showToast(`Topic marked as completed! ${wasCompleted ? '(Status updated)' : ''}`, 'success');
        
    } else if (nextStatus === 'inprogress') {
        // Marking as IN PROGRESS
        Object.keys(topic.subtopics).forEach(subtopicName => {
            const subtopic = topic.subtopics[subtopicName];
            // Don't change hours, just update completion status
            if (subtopic.actualHours > 0) {
                subtopic.completed = true; // If hours exist, mark as completed
            } else {
                subtopic.completed = false;
            }
        });
        
        showToast(`Topic marked as in progress`, 'info');
        
    } else if (nextStatus === 'not-started') {
        // Marking as NOT STARTED - Reset only auto-calculated hours
        Object.keys(topic.subtopics).forEach(subtopicName => {
            const subtopic = topic.subtopics[subtopicName];
            
            // Only reset if it's NOT a manual entry
            if (subtopic.manualEntry !== true) {
                subtopic.actualHours = 0;
                console.log(`â†» Reset auto-calculated hours for ${subtopicName}`);
            } else {
                console.log(`âœ“ Kept manual hours for ${subtopicName}: ${subtopic.actualHours}`);
            }
            subtopic.completed = false;
        });
        
        showToast(`Topic marked as not started`, 'info');
    }
    
    // Update completed topics count
    updateCompletedTopics(subjectId);
    
    // Save progress
    DataStorage.save('progress', userProgress);
    
    // Refresh the UI
    loadSubjectContent();
    updateDashboard();
}
```

Step 7: Update the saveAllProgress function to properly mark manual entries

Find the saveAllProgress function and REPLACE IT ENTIRELY with:

```javascript
function saveAllProgress() {
    // Collect all time inputs
    const timeInputs = document.querySelectorAll('input[type="number"][id^="time-"]');
    let savedCount = 0;
    let manualEntriesCount = 0;
    
    timeInputs.forEach(input => {
        const id = input.id.replace('time-', '');
        const parts = id.split('-');
        
        if (parts.length < 3) return;
        
        const subjectId = parts[0];
        const topicNameEncoded = parts[1];
        const subtopicNameEncoded = parts.slice(2).join('-'); // Handle subtopic names with hyphens
        
        // Decode names (replace hyphens with spaces)
        const topicName = topicNameEncoded.replace(/-/g, ' ');
        const subtopicName = subtopicNameEncoded.replace(/-/g, ' ');
        
        const hours = parseFloat(input.value) || 0;
        
        if (hours >= 0) {
            // Ensure progress structure exists
            if (!userProgress.subjects[subjectId]) {
                userProgress.subjects[subjectId] = { 
                    topics: {}, 
                    completedTopics: 0, 
                    totalTopics: syllabusData[subjectId]?.topics?.length || 0 
                };
            }
            if (!userProgress.subjects[subjectId].topics[topicName]) {
                userProgress.subjects[subjectId].topics[topicName] = { 
                    status: 'not-started', 
                    subtopics: {} 
                };
            }
            if (!userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName]) {
                userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName] = { 
                    actualHours: 0, 
                    completed: false,
                    manualEntry: false
                };
            }
            
            const subtopic = userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName];
            const previousHours = subtopic.actualHours || 0;
            
            // Update hours
            subtopic.actualHours = hours;
            
            // Mark as manual entry if:
            // 1. Hours changed from previous value, OR
            // 2. User entered any hours (even if 0, as they explicitly set it)
            if (hours !== previousHours || hours === 0) {
                subtopic.manualEntry = true;
                manualEntriesCount++;
                console.log(`ðŸ“ Marked as manual entry: ${subtopicName} = ${hours} hours`);
            }
            
            // Update completion status based on hours
            if (hours > 0) {
                subtopic.completed = true;
                // Auto-mark topic as in-progress if hours added
                if (userProgress.subjects[subjectId].topics[topicName].status === 'not-started') {
                    userProgress.subjects[subjectId].topics[topicName].status = 'inprogress';
                }
            } else if (hours === 0 && subtopic.manualEntry) {
                // User explicitly set 0 hours - mark as not completed
                subtopic.completed = false;
            }
            
            savedCount++;
        }
    });
    
    // Update completed topics counts
    for (const subjectId in userProgress.subjects) {
        updateCompletedTopics(subjectId);
    }
    
    // Save to storage
    DataStorage.save('progress', userProgress);
    updateDashboard();
    
    // Show success message
    const message = manualEntriesCount > 0 
        ? `${savedCount} hours saved! (${manualEntriesCount} manual entries preserved)` 
        : `${savedCount} hours saved!`;
    
    showToast(message, 'success');
    
    // Highlight manual entries visually
    highlightManualEntries();
}
```

Step 8: Add a helper function to highlight manual entries

Add this function AFTER the saveAllProgress function:

```javascript
function highlightManualEntries() {
    // Remove existing highlights
    document.querySelectorAll('.manual-highlight').forEach(el => {
        el.classList.remove('manual-highlight');
    });
    
    // Add highlights to manual entries
    const timeInputs = document.querySelectorAll('input[type="number"][id^="time-"]');
    
    timeInputs.forEach(input => {
        const id = input.id.replace('time-', '');
        const parts = id.split('-');
        
        if (parts.length < 3) return;
        
        const subjectId = parts[0];
        const topicNameEncoded = parts[1];
        const subtopicNameEncoded = parts.slice(2).join('-');
        const topicName = topicNameEncoded.replace(/-/g, ' ');
        const subtopicName = subtopicNameEncoded.replace(/-/g, ' ');
        
        // Check if this is a manual entry
        if (userProgress.subjects[subjectId] &&
            userProgress.subjects[subjectId].topics[topicName] &&
            userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName] &&
            userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName].manualEntry === true) {
            
            // Add highlight class
            input.classList.add('manual-highlight');
            
            // Add a small indicator
            const parent = input.parentElement;
            if (parent && !parent.querySelector('.manual-indicator')) {
                const indicator = document.createElement('span');
                indicator.className = 'manual-indicator';
                indicator.innerHTML = ' <i class="fas fa-user-edit" title="Manually entered"></i>';
                indicator.style.color = '#3498db';
                indicator.style.fontSize = '12px';
                parent.appendChild(indicator);
            }
        }
    });
}
```

Step 9: Add CSS for highlighting manual entries

Add this CSS at the end of the style section:

```css
/* Manual entry highlighting */
.manual-highlight {
    border: 2px solid #3498db !important;
    background-color: rgba(52, 152, 219, 0.05) !important;
    font-weight: 600;
}

.manual-highlight:focus {
    box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.2) !important;
}

.manual-indicator {
    margin-left: 8px;
    font-size: 12px;
    color: #3498db;
}

.manual-tooltip {
    position: absolute;
    background: #2c3e50;
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 12px;
    z-index: 1000;
    white-space: nowrap;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s;
}

.manual-highlight:hover + .manual-tooltip {
    opacity: 1;
}
```

Step 10: Update the enableAppAccess function to auto-start

Find the enableAppAccess function (around line 1650-1670):

```javascript
function enableAppAccess() {
    document.getElementById('start-btn').style.display = 'block';
}
```

REPLACE WITH:

```javascript
function enableAppAccess() {
    // Hide welcome screen and show app immediately
    welcomeContainer.style.display = 'none';
    appContainer.style.display = 'block';
    appContainer.classList.add('active');
    
    // Update dashboard
    updateDashboard();
    
    // Schedule notifications if enabled
    scheduleNotifications();
    
    // Update user UI
    updateUserUI();
    
    showToast(`Welcome ${currentUser.name}! Starting your study tracker...`, 'success');
}
```

Step 11: Also update the useDemoLicense function to auto-start

In the useDemoLicense function, find where it calls enableAppAccess() and make sure it's there.

Step 12: Update the license activation validation to show clearer messages

Find the showLicenseStatus function and add better feedback:

```javascript
function showLicenseStatus(type, message) {
    const statusEl = document.getElementById('license-status');
    statusEl.className = `license-status ${type}`;
    
    // Different icons based on status
    let icon = 'fa-info-circle';
    if (type === 'active') icon = 'fa-check-circle';
    if (type === 'expired') icon = 'fa-exclamation-circle';
    if (type === 'trial') icon = 'fa-clock';
    
    statusEl.innerHTML = `<i class="fas ${icon}"></i> ${message}`;
    
    // Update footer status
    const footerStatus = document.getElementById('footer-license-status');
    if (footerStatus) {
        footerStatus.textContent = type === 'active' ? 'License: Premium Active' : 
                                 type === 'trial' ? 'License: Trial Active' : 
                                 'License: Not Active';
    }
    
    // Update app header status
    const headerStatus = document.getElementById('license-status-text');
    if (headerStatus) {
        headerStatus.textContent = type === 'active' ? 'Premium' : 
                                  type === 'trial' ? 'Trial' : 'Inactive';
    }
    
    // Show/hide trial status
    const trialStatus = document.getElementById('trial-status');
    if (trialStatus) {
        trialStatus.style.display = type === 'trial' ? 'inline' : 'none';
    }
}
```

PART 3: Update Subject Content Display to Show Manual Entry Status

Step 13: Update the subtopic rendering in renderSubject function

Find where subtopics are rendered in the renderSubject function (look for the subtopic HTML generation):

Find this pattern in the renderSubject function:

```javascript
return `<div class="subtopic-item">
    <div class="subtopic-info">
        <div class="subtopic-name">${subtopic.name}</div>
        <div class="subtopic-details">
            <span>Weight: ${subtopic.weight}%</span>
            ${completed ? '<span style="color: var(--success);"><i class="fas fa-check"></i> Completed</span>' : ''}
        </div>
    </div>
    <div class="subtopic-actions">
        <div class="time-info">
            <div class="actual-time-input">
                <input type="number" 
                       id="time-${subjectId}-${topic.name.replace(/\s+/g, '-')}-${subtopic.name.replace(/\s+/g, '-')}"
                       value="${hours}"
                       min="0" 
                       step="0.5"
                       placeholder="Hours"
                       style="width: 100px;">
                <span>hrs</span>
            </div>
        </div>
    </div>
</div>`;
```

REPLACE WITH:

```javascript
// Check if this is a manual entry
const isManual = subtopicProgress.manualEntry === true;
const manualClass = isManual ? 'manual-highlight' : '';

return `<div class="subtopic-item">
    <div class="subtopic-info">
        <div class="subtopic-name">${subtopic.name} 
            ${isManual ? '<span class="manual-indicator" title="Manually entered"><i class="fas fa-user-edit"></i></span>' : ''}
        </div>
        <div class="subtopic-details">
            <span>Weight: ${subtopic.weight}%</span>
            ${completed ? '<span style="color: var(--success);"><i class="fas fa-check"></i> Completed</span>' : ''}
            ${isManual ? '<span style="color: #3498db; margin-left: 10px;"><i class="fas fa-user"></i> Manual</span>' : ''}
        </div>
    </div>
    <div class="subtopic-actions">
        <div class="time-info">
            <div class="actual-time-input">
                <input type="number" 
                       id="time-${subjectId}-${topic.name.replace(/\s+/g, '-')}-${subtopic.name.replace(/\s+/g, '-')}"
                       value="${hours.toFixed(1)}"
                       min="0" 
                       step="0.5"
                       placeholder="Hours"
                       class="${manualClass}"
                       style="width: 120px; ${isManual ? 'border: 2px solid #3498db; background-color: rgba(52, 152, 219, 0.05);' : ''}">
                <span>hrs</span>
            </div>
        </div>
    </div>
</div>`;
```

ðŸ“‹ IMPLEMENTATION ORDER

Copy and paste in this exact order:

1. HTML Changes (Steps 1, 3)
   Â· Remove Start Tracking button
   Â· Update license input layout
2. CSS Changes (Steps 2, 4, 5, 9)
   Â· Fix license page layout
   Â· Add manual entry highlighting
3. JavaScript Changes (Steps 6, 7, 8, 10, 11, 12, 13)
   Â· Fix subject hours logic
   Â· Add manual entry tracking
   Â· Auto-start app on activation
   Â· Update subject display

ðŸŽ¯ KEY FIXES MADE:

1. âœ… License Page Flow: Single "Activate & Start" button - no confusion
2. âœ… Better Desktop Layout: Grid layout for inputs on desktop
3. âœ… Manual Hours Respect: User-entered hours are NEVER overwritten
4. âœ… Visual Indicators: Shows which entries are manual vs auto-calculated
5. âœ… Auto-start: App starts automatically after successful activation
6. âœ… Clear Feedback: Better status messages and visual feedback

ðŸ”§ TROUBLESHOOTING TIPS:

If you encounter issues:

1. Check Console: Press F12 â†’ Console to see any JavaScript errors
2. Clear Browser Data: Sometimes old cached JavaScript causes issues
3. Test Step by Step: Make one change at a time and test
4. Verify Function Names: Make sure function names match exactly

The most important fix is in toggleTopicStatus() - it now properly checks subtopic.manualEntry before deciding whether to auto-calculate hours. Manual entries are preserved forever!

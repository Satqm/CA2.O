Looking at your code, I can see two main issues: license key validation not working properly and mobile layout problems. Let me provide you with step-by-step fixes.

Issue 1: License Key Validation Not Working

The Problem: The validation logic in your main app doesn't match the generator's checksum algorithm.

Step-by-Step Fix:

1. Find the validateLicense function (around line 1200-1300 in your main app file)
   Look for this function that starts with:
   ```javascript
   function validateLicense(licenseKey) {
   ```
2. Delete the entire function and replace it with this corrected version:

```javascript
function validateLicense(licenseKey) {
    try {
        // ===== STEP 1: CLEAN AND SANITIZE =====
        let cleanKey = licenseKey.trim().toUpperCase();
        
        // Remove ALL non-alphanumeric characters (dashes, spaces, etc.)
        cleanKey = cleanKey.replace(/[^A-Z0-9]/g, '');
        
        console.log('License validation:', { original: licenseKey, cleanKey });
        
        // ===== STEP 2: HANDLE DEMO LICENSE =====
        const demoKeyClean = "DEMOCAFINAL2C";
        if (cleanKey === demoKeyClean) {
            return { 
                valid: true, 
                data: { 
                    key: "DEMO-CAFI-NAL2-C",
                    type: 'DEMO', 
                    customer: "Demo User",
                    expiry: getExpiryDate('TRIAL', 7)  // 7-day trial
                } 
            };
        }
        
        // ===== STEP 3: CHECK LENGTH =====
        // Format should be 13 alphanumeric characters (12 payload + 1 checksum)
        if (cleanKey.length !== 13) {
            return { 
                valid: false, 
                error: `License key must be 13 characters (got ${cleanKey.length}). Format: XXXX-XXXX-XXXX-C` 
            };
        }
        
        // ===== STEP 4: VALIDATE ALPHANUMERIC =====
        if (!/^[A-Z0-9]{13}$/.test(cleanKey)) {
            return { 
                valid: false, 
                error: 'License key must contain only letters A-Z and numbers 0-9' 
            };
        }
        
        // ===== STEP 5: EXTRACT PAYLOAD AND CHECKSUM =====
        const payload = cleanKey.substring(0, 12);
        const providedChecksum = cleanKey.substring(12, 13);
        
        // ===== STEP 6: WEIGHTED MODULO-36 CHECKSUM CALCULATION =====
        let sum = 0;
        
        for (let i = 0; i < payload.length; i++) {
            const char = payload.charAt(i);
            let charValue;
            
            // Convert character to value (0-9, A-Z)
            if (char >= '0' && char <= '9') {
                charValue = parseInt(char);
            } else if (char >= 'A' && char <= 'Z') {
                charValue = char.charCodeAt(0) - 55; // A=10, B=11, ..., Z=35
            } else {
                return { valid: false, error: `Invalid character in license key: ${char}` };
            }
            
            const weight = i + 1; // 1-based position
            sum += charValue * weight;
        }
        
        // Calculate modulo 36
        const moduloResult = sum % 36;
        
        // Convert result to base-36 character (0-9, A-Z)
        let calculatedChecksum;
        if (moduloResult < 10) {
            calculatedChecksum = moduloResult.toString(); // 0-9
        } else {
            calculatedChecksum = String.fromCharCode(moduloResult + 55); // A-Z
        }
        
        // ===== STEP 7: VERIFY CHECKSUM =====
        if (calculatedChecksum !== providedChecksum) {
            return { 
                valid: false, 
                error: `Invalid license key. Checksum mismatch: expected ${calculatedChecksum}, got ${providedChecksum}` 
            };
        }
        
        // ===== STEP 8: DETERMINE LICENSE TYPE =====
        let licenseType = 'PREMIUM';
        let customerName = 'Premium User';
        
        // Check for special prefixes (same as generator)
        if (payload.startsWith('DEMO')) {
            licenseType = 'DEMO';
            customerName = 'Demo User';
        } else if (payload.startsWith('STU')) {
            licenseType = 'STUDENT';
            customerName = 'Student User';
        } else if (payload.startsWith('TRIAL')) {
            licenseType = 'TRIAL';
            customerName = 'Trial User';
        }
        
        // ===== STEP 9: EXPIRY DATE BASED ON TYPE =====
        let expiryDate;
        switch(licenseType) {
            case 'PREMIUM':
                expiryDate = getExpiryDate('PREMIUM', 365);
                break;
            case 'STUDENT':
                expiryDate = getExpiryDate('STUDENT', 180);
                break;
            case 'TRIAL':
                expiryDate = getExpiryDate('TRIAL', 30);
                break;
            case 'DEMO':
                expiryDate = getExpiryDate('TRIAL', 7); // 7-day demo
                break;
            default:
                expiryDate = getExpiryDate('PREMIUM', 365);
        }
        
        // ===== STEP 10: FORMAT KEY FOR DISPLAY =====
        const formattedKey = cleanKey.substring(0, 4) + '-' + 
                           cleanKey.substring(4, 8) + '-' + 
                           cleanKey.substring(8, 12) + '-' + 
                           providedChecksum;
        
        // ===== STEP 11: RETURN VALID LICENSE =====
        return { 
            valid: true, 
            data: { 
                key: formattedKey,
                originalKey: licenseKey,
                type: licenseType, 
                customer: customerName, 
                expiry: expiryDate,
                deviceId: deviceId,
                checksumVerified: true,
                validationDate: new Date().toISOString()
            } 
        };
        
    } catch (error) {
        console.error('License validation error:', error);
        return { valid: false, error: 'License validation failed: ' + error.message };
    }
}
```

1. Add this helper function if it doesn't exist (right after the validateLicense function):

```javascript
function getExpiryDate(type, days) {
    const today = new Date();
    const expiryDate = new Date(today);
    expiryDate.setDate(today.getDate() + days);
    return expiryDate.toISOString().split('T')[0];
}
```

Issue 2: Mobile Layout - Fixing Welcome Screen

The Problem: On mobile, the activation button layout is broken.

Step-by-Step Fix:

1. Find the .welcome-box CSS (around line 100-150 in your main app file)
   Look for this section:
   ```css
   .welcome-box {
       background: rgba(255, 255, 255, 0.95);
       backdrop-filter: blur(10px);
       /* ... other styles */
   }
   ```
2. Replace the entire .welcome-box CSS block with this improved version:

```css
.welcome-box {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 24px;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
    width: 100%;
    max-width: 500px; /* Reduced for better mobile fit */
    padding: 30px;
    position: relative;
    z-index: 1;
    border: 1px solid rgba(255, 255, 255, 0.3);
    margin: 20px; /* Added margin for mobile safety */
}

/* For larger screens */
@media (min-width: 768px) {
    .welcome-box {
        padding: 40px;
        max-width: 500px;
    }
}

/* For very small screens */
@media (max-width: 480px) {
    .welcome-box {
        padding: 25px 20px;
        margin: 15px;
    }
}
```

1. Find the .license-input-group CSS and replace it with:

```css
.license-input-group {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin-bottom: 25px;
}

.activate-button-container {
    margin-top: 10px;
}

.license-activate-btn {
    padding: 16px 20px;
    background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    width: 100%;
    height: 52px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.license-activate-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(46, 204, 113, 0.3);
}

.license-activate-btn i {
    font-size: 18px;
}

.license-activate-btn:disabled {
    background: var(--gray);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}
```

1. Find the .license-actions CSS and replace it with:

```css
.license-actions {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin: 25px 0;
    width: 100%;
}

.license-actions .use-demo-btn,
.license-actions .get-license-btn {
    padding: 16px 20px;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    border: none;
    font-size: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    text-decoration: none;
    width: 100%;
    text-align: center;
}

.license-actions .use-demo-btn {
    background: #f8f9fa;
    color: var(--primary);
    border: 2px solid var(--secondary);
}

.license-actions .get-license-btn {
    background: #25D366;
    color: white;
    border: 2px solid #25D366;
}

.license-actions .use-demo-btn:hover,
.license-actions .get-license-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
}

/* For larger screens */
@media (min-width: 768px) {
    .license-actions {
        flex-direction: row;
    }
    
    .license-actions .use-demo-btn,
    .license-actions .get-license-btn {
        width: auto;
        min-width: 200px;
    }
}
```

Additional Fix: Auto-format License Input

Add this code at the end of your script, just before the closing </script> tag:

```javascript
// Auto-format license key as user types
document.getElementById('license-input').addEventListener('input', function(e) {
    let value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
    
    // Auto-insert dashes at correct positions
    if (value.length > 4 && value.length <= 8) {
        value = value.substring(0, 4) + '-' + value.substring(4);
    } else if (value.length > 8 && value.length <= 12) {
        value = value.substring(0, 4) + '-' + value.substring(4, 8) + '-' + value.substring(8);
    } else if (value.length > 12) {
        value = value.substring(0, 4) + '-' + value.substring(4, 8) + '-' + 
                value.substring(8, 12) + '-' + value.substring(12, 13);
    }
    
    e.target.value = value;
});

// Highlight manual entries
function highlightManualEntries() {
    document.querySelectorAll('.manual-highlight').forEach(el => {
        el.classList.remove('manual-highlight');
    });
    
    const timeInputs = document.querySelectorAll('input[type="number"][id^="time-"]');
    timeInputs.forEach(input => {
        const id = input.id.replace('time-', '');
        const parts = id.split('-');
        
        if (parts.length < 3) return;
        
        const subjectId = parts[0];
        const topicNameEncoded = parts[1];
        const subtopicNameEncoded = parts.slice(2).join('-');
        const topicName = topicNameEncoded.replace(/-/g, ' ');
        const subtopicName = subtopicNameEncoded.replace(/-/g, ' ');
        
        // Check if this is a manual entry
        if (userProgress.subjects[subjectId] &&
            userProgress.subjects[subjectId].topics[topicName] &&
            userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName] &&
            userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName].manualEntry === true) {
            
            input.classList.add('manual-highlight');
        }
    });
}
```

Summary of Changes:

1. Fixed license validation to match your generator's algorithm exactly
2. Improved mobile layout with proper responsive design
3. Added auto-formatting for license key input
4. Ensured all buttons stay inside the white welcome box on mobile

To apply these changes:

1. Copy each code block above
2. Find the corresponding sections in your main app file
3. Delete the old code and paste the new code
4. Save the file and test on your phone

The layout will now look clean and professional on all devices, and the license keys will validate correctly using the same algorithm as your generator tool.

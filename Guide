Looking at your code, I can see several issues with the license system. Let me provide you with the fixes step by step:

FIX 1: License Validation is Not Working Properly

Problem: The validateLicense() function is not properly validating the license key format.

Find this code in your main app (around line 2300-2400):

```javascript
function validateLicense(licenseKey) {
    // This function has issues
}
```

Replace it with this corrected version:

```javascript
function validateLicense(licenseKey) {
    try {
        // ===== STEP 1: CLEAN AND SANITIZE =====
        let cleanKey = licenseKey.trim().toUpperCase();
        
        // Remove ALL non-alphanumeric characters (dashes, spaces, etc.)
        cleanKey = cleanKey.replace(/[^A-Z0-9]/g, '');
        
        console.log('License validation:', { original: licenseKey, cleanKey });
        
        // ===== STEP 2: HANDLE DEMO LICENSE =====
        const demoKeyClean = "DEMOCAFINAL2C";
        if (cleanKey === demoKeyClean) {
            return { 
                valid: true, 
                data: { 
                    key: "DEMO-CAFI-NAL2-C",
                    type: 'DEMO', 
                    customer: "Demo User",
                    expiry: getExpiryDate('TRIAL', 7)  // 7-day trial
                } 
            };
        }
        
        // ===== STEP 3: CHECK LENGTH =====
        // Format should be 13 alphanumeric characters (12 payload + 1 checksum)
        if (cleanKey.length !== 13) {
            return { 
                valid: false, 
                error: `License key must be 13 characters (got ${cleanKey.length}). Format: XXXX-XXXX-XXXX-C` 
            };
        }
        
        // ===== STEP 4: VALIDATE ALPHANUMERIC =====
        if (!/^[A-Z0-9]{13}$/.test(cleanKey)) {
            return { 
                valid: false, 
                error: 'License key must contain only letters A-Z and numbers 0-9' 
            };
        }
        
        // ===== STEP 5: EXTRACT PAYLOAD AND CHECKSUM =====
        const payload = cleanKey.substring(0, 12);
        const providedChecksum = cleanKey.substring(12, 13);
        
        // ===== STEP 6: WEIGHTED MODULO-36 CHECKSUM CALCULATION =====
        let sum = 0;
        
        for (let i = 0; i < payload.length; i++) {
            const char = payload.charAt(i);
            let charValue;
            
            // Convert character to value (0-9, A-Z)
            if (char >= '0' && char <= '9') {
                charValue = parseInt(char);
            } else if (char >= 'A' && char <= 'Z') {
                charValue = char.charCodeAt(0) - 55; // A=10, B=11, ..., Z=35
            } else {
                return { valid: false, error: `Invalid character in license key: ${char}` };
            }
            
            const weight = i + 1; // 1-based position
            sum += charValue * weight;
        }
        
        // Calculate modulo 36
        const moduloResult = sum % 36;
        
        // Convert result to base-36 character (0-9, A-Z)
        let calculatedChecksum;
        if (moduloResult < 10) {
            calculatedChecksum = moduloResult.toString(); // 0-9
        } else {
            calculatedChecksum = String.fromCharCode(moduloResult + 55); // A-Z
        }
        
        // ===== STEP 7: VERIFY CHECKSUM =====
        if (calculatedChecksum !== providedChecksum) {
            return { 
                valid: false, 
                error: `Invalid license key. Checksum mismatch: expected ${calculatedChecksum}, got ${providedChecksum}` 
            };
        }
        
        // ===== STEP 8: DETERMINE LICENSE TYPE =====
        let licenseType = 'PREMIUM';
        let customerName = 'Premium User';
        
        // Check for special prefixes (same as generator)
        if (payload.startsWith('DEMO')) {
            licenseType = 'DEMO';
            customerName = 'Demo User';
        } else if (payload.startsWith('STU')) {
            licenseType = 'STUDENT';
            customerName = 'Student User';
        } else if (payload.startsWith('TRIAL')) {
            licenseType = 'TRIAL';
            customerName = 'Trial User';
        }
        
        // ===== STEP 9: EXPIRY DATE BASED ON TYPE =====
        let expiryDate;
        switch(licenseType) {
            case 'PREMIUM':
                expiryDate = getExpiryDate('PREMIUM', 365);
                break;
            case 'STUDENT':
                expiryDate = getExpiryDate('STUDENT', 180);
                break;
            case 'TRIAL':
                expiryDate = getExpiryDate('TRIAL', 30);
                break;
            case 'DEMO':
                expiryDate = getExpiryDate('TRIAL', 7); // 7-day demo
                break;
            default:
                expiryDate = getExpiryDate('PREMIUM', 365);
        }
        
        // ===== STEP 10: FORMAT KEY FOR DISPLAY =====
        const formattedKey = cleanKey.substring(0, 4) + '-' + 
                           cleanKey.substring(4, 8) + '-' + 
                           cleanKey.substring(8, 12) + '-' + 
                           providedChecksum;
        
        // ===== STEP 11: RETURN VALID LICENSE =====
        return { 
            valid: true, 
            data: { 
                key: formattedKey,
                originalKey: licenseKey,
                type: licenseType, 
                customer: customerName, 
                expiry: expiryDate,
                deviceId: deviceId,
                checksumVerified: true,
                validationDate: new Date().toISOString()
            } 
        };
        
    } catch (error) {
        console.error('License validation error:', error);
        return { valid: false, error: 'License validation failed: ' + error.message };
    }
}

// Add this helper function for expiry dates
function getExpiryDate(type, days) {
    const today = new Date();
    const expiryDate = new Date(today);
    expiryDate.setDate(today.getDate() + days);
    return expiryDate.toISOString().split('T')[0];
}
```

FIX 2: enableAppAccess() Function is Missing/Incomplete

Find this code (around line 2600-2700):

```javascript
function enableAppAccess() {
    // This function is incomplete
}
```

Replace it with:

```javascript
function enableAppAccess() {
    // Hide welcome screen and show app immediately
    document.getElementById('welcome-container').style.display = 'none';
    document.getElementById('app-container').style.display = 'block';
    document.getElementById('app-container').classList.add('active');
    
    // Update user name from input
    const userName = document.getElementById('user-name-input').value.trim() || 'User';
    currentUser.name = userName;
    currentUser.initials = userName.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
    
    // Update UI
    updateUserUI();
    
    // Update dashboard
    updateDashboard();
    
    // Show success message
    showToast(`Welcome ${currentUser.name}! Starting your study tracker...`, 'success');
    
    // Save user data
    DataStorage.save('user', currentUser);
    
    // For demo license, set trial data
    if (currentLicense && currentLicense.type === 'DEMO') {
        const trialData = {
            active: true,
            startDate: new Date().toISOString(),
            days: 7
        };
        DataStorage.save('trial', trialData);
        isTrialActive = true;
        trialDaysLeft = 7;
        
        // Show trial info
        document.getElementById('trial-info').style.display = 'block';
        document.getElementById('trial-days').textContent = trialDaysLeft;
    }
}
```

FIX 3: Update activateLicense() Function

Find this function (around line 2500-2600):

```javascript
function activateLicense() {
    // Current implementation has issues
}
```

Replace the ENTIRE activateLicense() function with:

```javascript
function activateLicense() {
    const userNameInput = document.getElementById('user-name-input');
    const licenseInput = document.getElementById('license-input');
    let userName = userNameInput.value.trim();
    let licenseKey = licenseInput.value;
    
    if (!userName) {
        showLicenseStatus('expired', 'Please enter your name');
        userNameInput.focus();
        return;
    }
    
    if (!licenseKey) {
        showLicenseStatus('expired', 'Please enter a license key');
        licenseInput.focus();
        return;
    }
    
    // Clean the license key
    licenseKey = licenseKey.trim().toUpperCase();
    userName = userName.substring(0, 50);
    
    // Update inputs with cleaned values
    userNameInput.value = userName;
    
    // Handle demo license
    const demoKeyClean = "DEMOCAFINAL2C";
    if (licenseKey.replace(/[^A-Z0-9]/g, '') === demoKeyClean) {
        licenseInput.value = "DEMO-CAFI-NAL2-C";
        licenseKey = "DEMO-CAFI-NAL2-C";
        
        currentLicense = {
            key: "DEMO-CAFI-NAL2-C",
            type: 'DEMO',
            customer: userName || 'Demo User',
            expiry: getExpiryDate('TRIAL', 7),
            deviceId: deviceId
        };
        
        DataStorage.save('license', currentLicense);
        showLicenseStatus('active', 'Demo license activated! 7-day trial started.');
        licenseInput.classList.add('valid');
        userNameInput.classList.add('valid');
        
        enableAppAccess();
        return;
    }
    
    const validation = validateLicense(licenseKey);
            
    if (validation.valid) {
        currentLicense = validation.data;
        currentLicense.customer = userName || validation.data.customer;
        
        // Store user name
        currentUser.name = userName;
        currentUser.initials = userName.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        
        DataStorage.save('license', currentLicense);
        DataStorage.save('user', currentUser);
        
        showLicenseStatus('active', 'License activated successfully!');
        licenseInput.classList.add('valid');
        userNameInput.classList.add('valid');
        
        enableAppAccess();
    } else {
        showLicenseStatus('expired', validation.error || 'Invalid license key');
        licenseInput.classList.add('invalid');
        licenseInput.classList.remove('valid');
    }
}
```

FIX 4: Update useDemoLicense() Function

Find this function (around line 2700-2800):

```javascript
function useDemoLicense() {
    // Current implementation
}
```

Replace it with:

```javascript
function useDemoLicense() {
    const userNameInput = document.getElementById('user-name-input');
    const licenseInput = document.getElementById('license-input');
    
    // Auto-fill name if empty
    if (!userNameInput.value.trim()) {
        userNameInput.value = "Demo User";
    }
    
    // Auto-fill demo license key
    licenseInput.value = "DEMO-CAFI-NAL2-C";
    
    // Visual feedback
    userNameInput.classList.add('manual-highlight');
    licenseInput.classList.add('manual-highlight');
    
    // Auto-activate immediately (no need for extra click)
    setTimeout(() => {
        activateLicense();
    }, 100);
    
    showToast('Demo license loaded! Starting 7-day trial...', 'success');
}
```

FIX 5: Update License Status Function

Find this function (around line 2800-2900):

```javascript
function showLicenseStatus(type, message) {
    // Current implementation
}
```

Make sure it has this content:

```javascript
function showLicenseStatus(type, message) {
    const statusEl = document.getElementById('license-status');
    statusEl.className = `license-status ${type}`;
    
    // Different icons based on status
    let icon = 'fa-info-circle';
    if (type === 'active') icon = 'fa-check-circle';
    if (type === 'expired') icon = 'fa-exclamation-circle';
    if (type === 'trial') icon = 'fa-clock';
    
    statusEl.innerHTML = `<i class="fas ${icon}"></i> ${message}`;
    statusEl.style.display = 'block';
    
    // Update footer status
    const footerStatus = document.getElementById('footer-license-status');
    if (footerStatus) {
        footerStatus.textContent = type === 'active' ? 'License: Premium Active' : 
                                 type === 'trial' ? 'License: Trial Active' : 
                                 'License: Not Active';
    }
    
    // Update app header status (if app is active)
    const headerStatus = document.getElementById('license-status-text');
    if (headerStatus) {
        headerStatus.textContent = type === 'active' ? 'Premium' : 
                                  type === 'trial' ? 'Trial' : 'Inactive';
    }
    
    // Show/hide trial status in app header
    const trialStatus = document.getElementById('trial-status');
    if (trialStatus) {
        trialStatus.style.display = type === 'trial' ? 'inline' : 'none';
    }
    
    // Show/hide trial info in welcome screen
    const trialInfo = document.getElementById('trial-info');
    if (trialInfo) {
        trialInfo.style.display = type === 'trial' ? 'block' : 'none';
    }
}
```

FIX 6: Add Auto-Formatting for License Input

Add this code RIGHT AFTER the useDemoLicense() function:

```javascript
// Auto-format license key as user types
document.getElementById('license-input').addEventListener('input', function(e) {
    let value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
    
    // Auto-insert dashes at correct positions
    if (value.length > 4 && value.length <= 8) {
        value = value.substring(0, 4) + '-' + value.substring(4);
    } else if (value.length > 8 && value.length <= 12) {
        value = value.substring(0, 4) + '-' + value.substring(4, 8) + '-' + value.substring(8);
    } else if (value.length > 12) {
        value = value.substring(0, 4) + '-' + value.substring(4, 8) + '-' + 
                value.substring(8, 12) + '-' + value.substring(12, 13);
    }
    
    e.target.value = value;
});
```

FIX 7: Remove Redundant WhatsApp Link

Find this HTML code in your welcome screen (around line 300-350):

```html
<div style="text-align: center; margin-top: 20px;">
    <a href="https://wa.me/919142300129" target="_blank" class="whatsapp-cta">
        <i class="fab fa-whatsapp"></i> Contact for License on WhatsApp
    </a>
</div>
```

DELETE this entire block.

FIX 8: Check License on Page Load

Find this code (around line 2200-2300):

```javascript
function checkLicenseOnStartup() {
    // Current implementation
}
```

Make sure it has this content:

```javascript
function checkLicenseOnStartup() {
    // Load saved license
    currentLicense = DataStorage.load('license');
    const trialData = DataStorage.load('trial');
    
    if (trialData) {
        isTrialActive = trialData.active;
        trialStartDate = trialData.startDate;
        trialDaysLeft = calculateTrialDaysLeft(trialStartDate);
    }
    
    if (currentLicense) {
        const validation = validateLicense(currentLicense.key);
        if (validation.valid) {
            // Check if license is expired
            const expiryDate = new Date(currentLicense.expiry);
            const today = new Date();
            
            if (expiryDate >= today) {
                showLicenseStatus('active', 'License active. Welcome back!');
                enableAppAccess();
            } else {
                showLicenseStatus('expired', 'License has expired');
                checkTrialAccess();
            }
        } else {
            showLicenseStatus('expired', 'License validation failed');
            checkTrialAccess();
        }
    } else {
        checkTrialAccess();
    }
}
```

Summary of Changes Made:

1. Fixed validateLicense() - Now properly validates the 13-character format with checksum
2. Fixed enableAppAccess() - Now properly shows the app and hides welcome screen
3. Fixed activateLicense() - Now properly validates and activates licenses
4. Fixed useDemoLicense() - Now auto-activates without requiring extra clicks
5. Added auto-formatting - License key auto-formats with dashes as you type
6. Removed redundant WhatsApp link - Cleaned up the welcome screen
7. Fixed startup check - Properly checks license on page load

Important: Make sure you have this line at the TOP of your JavaScript (after global variables):

```javascript
let deviceId = generateDeviceId(); // Add this function

function generateDeviceId() {
    return 'DEVICE-' + Math.random().toString(36).substr(2, 9).toUpperCase();
}
```

These fixes should resolve all your license issues. The demo license will now:

1. Auto-fill the inputs
2. Auto-activate (no extra click needed)
3. Set a 7-day trial in localStorage
4. Immediately show the dashboard
